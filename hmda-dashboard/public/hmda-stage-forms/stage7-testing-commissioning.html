<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage 7: Testing & Commissioning - HMDA PES</title>
    <link rel="stylesheet" href="shared/styles.css">
    <link rel="stylesheet" href="shared/feedback-system.css">
    <style>
        .readiness-dashboard {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border: 1px solid #0284c7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .readiness-dashboard h3 {
            color: #0369a1;
            margin-bottom: 15px;
        }
        
        .readiness-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .readiness-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #7dd3fc;
            text-align: center;
        }
        
        .readiness-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .ready { color: #059669; }
        .partial { color: #f59e0b; }
        .not-ready { color: #ef4444; }
        
        .pre-comm-activities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .activity-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }
        
        .activity-card.completed::before {
            background: #059669;
        }
        
        .activity-card.in-progress::before {
            background: #3b82f6;
        }
        
        .activity-card.not-started::before {
            background: #6b7280;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .activity-title {
            font-weight: 600;
            color: #1e293b;
        }
        
        .activity-status {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .status-completed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-in-progress {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .status-not-started {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .test-matrix {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .test-category {
            margin-bottom: 25px;
        }
        
        .test-category h4 {
            color: #1e293b;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .test-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-item.passed {
            background: #f0fdf4;
            border-color: #86efac;
        }
        
        .test-item.failed {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .test-item.in-progress {
            background: #eff6ff;
            border-color: #bfdbfe;
        }
        
        .test-label {
            font-weight: 600;
            color: #1e293b;
        }
        
        .performance-results {
            background: #fefce8;
            border: 2px solid #fde047;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #fde68a;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .metric-target {
            font-size: 0.75rem;
            color: #92400e;
            margin-top: 5px;
        }
        
        .issue-tracker {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .issue-summary {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .issue-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #fecaca;
        }
        
        .issue-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
        }
        
        .issue-stat-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 5px;
        }
        
        .documentation-checklist {
            background: #f0f9ff;
            border: 1px solid #0284c7;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .doc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .doc-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0f2fe;
        }
        
        .doc-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .training-section {
            background: #ecfdf5;
            border: 1px solid #059669;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .training-progress {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .training-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #86efac;
        }
        
        .progress-bar {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            background: #059669;
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .commissioning-approval {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #059669;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .approval-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            background: #059669;
            color: white;
        }
        
        .final-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .status-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .status-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .status-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .status-value {
            font-size: 1rem;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <div class="form-title">
                <h1>Stage 7: Testing & Commissioning</h1>
                <p>Conduct comprehensive testing and commission the project systems</p>
            </div>
            <div class="form-meta">
                <div class="meta-item">
                    <span class="meta-label">Project Code</span>
                    <span class="meta-value">HMDA/EE/2025/0001</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Stage</span>
                    <span class="meta-value">7 of 9</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Status</span>
                    <span class="meta-value status-active">In Progress</span>
                </div>
            </div>
        </div>

        <div class="progress-tracker">
            <div class="progress-step completed">1. Conceptualization</div>
            <div class="progress-step completed">2. DPR & Approvals</div>
            <div class="progress-step completed">3. Tendering</div>
            <div class="progress-step completed">4. Contract Award</div>
            <div class="progress-step completed">5. Execution</div>
            <div class="progress-step completed">6. Quality Control</div>
            <div class="progress-step active">7. Testing</div>
            <div class="progress-step">8. Closure</div>
            <div class="progress-step">9. DLP & O&M</div>
        </div>

        <form id="stage7Form" class="stage-form">
            <!-- Project Readiness Assessment -->
            <div class="form-section">
                <h2>Project Readiness Assessment</h2>
                <div class="readiness-dashboard">
                    <h3>Testing & Commissioning Readiness</h3>
                    <div class="readiness-indicators">
                        <div class="readiness-item">
                            <div class="readiness-icon ready">✅</div>
                            <div>Project Code</div>
                            <strong>HMDA/EE/2025/0001</strong>
                        </div>
                        <div class="readiness-item">
                            <div class="readiness-icon ready">✅</div>
                            <div>Construction Status</div>
                            <strong>Substantially Complete</strong>
                        </div>
                        <div class="readiness-item">
                            <div class="readiness-icon partial">⚠️</div>
                            <div>Quality Control</div>
                            <strong>Quality Issues Resolved</strong>
                        </div>
                        <div class="readiness-item">
                            <div class="readiness-icon partial">⚠️</div>
                            <div>Testing Readiness</div>
                            <strong>Partially Ready</strong>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="testingReadiness">Testing Readiness Assessment <span class="required">*</span></label>
                    <select id="testingReadiness" name="testingReadiness" required>
                        <option value="Ready for Testing">Ready for Testing</option>
                        <option value="Partially Ready" selected>Partially Ready</option>
                        <option value="Not Ready">Not Ready</option>
                    </select>
                </div>
            </div>

            <!-- Pre-Commissioning Activities -->
            <div class="form-section">
                <h2>Pre-Commissioning Activities</h2>
                <div class="pre-comm-activities">
                    <div class="activity-card completed">
                        <div class="activity-header">
                            <span class="activity-title">System Isolation</span>
                            <span class="activity-status status-completed">Completed</span>
                        </div>
                        <select id="systemIsolation" name="systemIsolation" required>
                            <option value="Completed" selected>Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                        </select>
                    </div>
                    
                    <div class="activity-card completed">
                        <div class="activity-header">
                            <span class="activity-title">System Cleaning</span>
                            <span class="activity-status status-completed">Completed</span>
                        </div>
                        <select id="systemCleaning" name="systemCleaning" required>
                            <option value="Completed" selected>Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                        </select>
                    </div>
                    
                    <div class="activity-card in-progress">
                        <div class="activity-header">
                            <span class="activity-title">Equipment Installation</span>
                            <span class="activity-status status-in-progress">In Progress</span>
                        </div>
                        <select id="equipmentInstallation" name="equipmentInstallation" required>
                            <option value="All Installed">All Installed</option>
                            <option value="Partially Installed" selected>Partially Installed</option>
                            <option value="Installation Pending">Installation Pending</option>
                        </select>
                    </div>
                    
                    <div class="activity-card completed">
                        <div class="activity-header">
                            <span class="activity-title">Cable Termination</span>
                            <span class="activity-status status-completed">Completed</span>
                        </div>
                        <select id="cableTermination" name="cableTermination">
                            <option value="Completed" selected>Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    
                    <div class="activity-card completed">
                        <div class="activity-header">
                            <span class="activity-title">Piping Pressure Test</span>
                            <span class="activity-status status-completed">Passed</span>
                        </div>
                        <select id="pipingPressureTest" name="pipingPressureTest">
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    
                    <div class="activity-card in-progress">
                        <div class="activity-header">
                            <span class="activity-title">Instrument Calibration</span>
                            <span class="activity-status status-in-progress">In Progress</span>
                        </div>
                        <select id="instrumentCalibration" name="instrumentCalibration">
                            <option value="Completed">Completed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Pending">Pending</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Individual System Testing -->
            <div class="form-section">
                <h2>Individual System Testing</h2>
                <div class="test-matrix">
                    <div class="test-category">
                        <h4>Core Systems</h4>
                        <div class="test-grid">
                            <div class="test-item passed">
                                <label class="test-label">Electrical System Testing</label>
                                <select id="electricalSystemTest" name="electricalSystemTest" required>
                                    <option value="Passed" selected>Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                </select>
                            </div>
                            
                            <div class="test-item in-progress">
                                <label class="test-label">Mechanical System Testing</label>
                                <select id="mechanicalSystemTest" name="mechanicalSystemTest">
                                    <option value="Passed">Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress" selected>In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                            
                            <div class="test-item passed">
                                <label class="test-label">HVAC System Testing</label>
                                <select id="hvacSystemTest" name="hvacSystemTest">
                                    <option value="Passed" selected>Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                            
                            <div class="test-item passed">
                                <label class="test-label">Plumbing System Testing</label>
                                <select id="plumbingSystemTest" name="plumbingSystemTest">
                                    <option value="Passed" selected>Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="test-category">
                        <h4>Safety & Security Systems</h4>
                        <div class="test-grid">
                            <div class="test-item passed">
                                <label class="test-label">Fire Alarm System Testing</label>
                                <select id="fireAlarmSystemTest" name="fireAlarmSystemTest">
                                    <option value="Passed" selected>Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                            
                            <div class="test-item in-progress">
                                <label class="test-label">Security System Testing</label>
                                <select id="securitySystemTest" name="securitySystemTest">
                                    <option value="Passed">Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress" selected>In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                            
                            <div class="test-item passed">
                                <label class="test-label">Communication System Testing</label>
                                <select id="communicationSystemTest" name="communicationSystemTest">
                                    <option value="Passed" selected>Passed</option>
                                    <option value="Failed">Failed</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Not Started">Not Started</option>
                                    <option value="Not Applicable">Not Applicable</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="totalSystemsToTest">Total Systems to Test</label>
                        <input type="number" id="totalSystemsToTest" name="totalSystemsToTest" value="7" readonly>
                    </div>
                    <div class="form-group">
                        <label for="systemsTestPassed">Systems Test Passed</label>
                        <input type="number" id="systemsTestPassed" name="systemsTestPassed" value="5" readonly>
                    </div>
                    <div class="form-group">
                        <label for="systemTestPassRate">System Test Pass Rate (%)</label>
                        <input type="number" id="systemTestPassRate" name="systemTestPassRate" value="71.43" readonly>
                    </div>
                </div>
            </div>

            <!-- Integrated System Testing -->
            <div class="form-section">
                <h2>Integrated System Testing</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="integratedTestPlan">Integrated Test Plan Status <span class="required">*</span></label>
                        <select id="integratedTestPlan" name="integratedTestPlan" required>
                            <option value="Approved" selected>Approved</option>
                            <option value="Under Review">Under Review</option>
                            <option value="Pending Submission">Pending Submission</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="systemIntegrationTest">System Integration Testing <span class="required">*</span></label>
                        <select id="systemIntegrationTest" name="systemIntegrationTest" required>
                            <option value="Passed">Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Not Started">Not Started</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loadTesting">Load Testing Status</label>
                        <select id="loadTesting" name="loadTesting">
                            <option value="Passed">Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="enduranceTest">Endurance Testing Status</label>
                        <select id="enduranceTest" name="enduranceTest">
                            <option value="Passed">Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started" selected>Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="interferenceTest">Interference Testing Status</label>
                        <select id="interferenceTest" name="interferenceTest">
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="failsafeTest">Fail-safe Testing Status</label>
                        <select id="failsafeTest" name="failsafeTest">
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="backupSystemTest">Backup System Testing</label>
                        <select id="backupSystemTest" name="backupSystemTest">
                            <option value="Passed">Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Not Started">Not Started</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Performance Validation -->
            <div class="form-section">
                <h2>Performance Validation</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="performanceParameterTest">Performance Parameter Testing <span class="required">*</span></label>
                        <select id="performanceParameterTest" name="performanceParameterTest" required>
                            <option value="All Parameters Met">All Parameters Met</option>
                            <option value="Some Parameters Failed" selected>Some Parameters Failed</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="efficiencyTest">Efficiency Testing Status <span class="required">*</span></label>
                        <select id="efficiencyTest" name="efficiencyTest" required>
                            <option value="Target Achieved">Target Achieved</option>
                            <option value="Below Target" selected>Below Target</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="capacityTest">Capacity Testing Status <span class="required">*</span></label>
                        <select id="capacityTest" name="capacityTest" required>
                            <option value="Full Capacity Achieved" selected>Full Capacity Achieved</option>
                            <option value="Partial Capacity">Partial Capacity</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="accuracyTest">Accuracy Testing Status</label>
                        <select id="accuracyTest" name="accuracyTest">
                            <option value="Within Tolerance" selected>Within Tolerance</option>
                            <option value="Outside Tolerance">Outside Tolerance</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="responseTimeTest">Response Time Testing</label>
                        <select id="responseTimeTest" name="responseTimeTest">
                            <option value="Within Limits" selected>Within Limits</option>
                            <option value="Exceeds Limits">Exceeds Limits</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reliabilityTest">Reliability Testing Status <span class="required">*</span></label>
                        <select id="reliabilityTest" name="reliabilityTest" required>
                            <option value="Reliable" selected>Reliable</option>
                            <option value="Reliability Issues">Reliability Issues</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Safety System Validation -->
            <div class="form-section">
                <h2>Safety System Validation</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="emergencyShutdownTest">Emergency Shutdown Testing <span class="required">*</span></label>
                        <select id="emergencyShutdownTest" name="emergencyShutdownTest" required>
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="safetyInterlockTest">Safety Interlock Testing <span class="required">*</span></label>
                        <select id="safetyInterlockTest" name="safetyInterlockTest" required>
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="alarmSystemTest">Alarm System Testing <span class="required">*</span></label>
                        <select id="alarmSystemTest" name="alarmSystemTest" required>
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="protectiveDeviceTest">Protective Device Testing <span class="required">*</span></label>
                        <select id="protectiveDeviceTest" name="protectiveDeviceTest" required>
                            <option value="Passed" selected>Passed</option>
                            <option value="Failed">Failed</option>
                            <option value="Testing In Progress">Testing In Progress</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="safetyCertification">Safety Certification Status</label>
                        <select id="safetyCertification" name="safetyCertification">
                            <option value="">Select Status</option>
                            <option value="Certified">Certified</option>
                            <option value="Conditional" selected>Conditional</option>
                            <option value="Rejected">Rejected</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Performance Testing Results -->
            <div class="form-section">
                <h2>Performance Testing Results</h2>
                <div class="performance-results">
                    <h3>Key Performance Indicators</h3>
                    <div class="performance-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Design Capacity Achievement</div>
                            <div class="metric-value">92%</div>
                            <div class="metric-target">Target: >95%</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Efficiency Achievement</div>
                            <div class="metric-value">88%</div>
                            <div class="metric-target">Target: >90%</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Energy Consumption</div>
                            <div class="metric-value">4,250</div>
                            <div class="metric-target">kWh (Target: <4,500)</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Water Consumption</div>
                            <div class="metric-value">12,500</div>
                            <div class="metric-target">Liters (Target: <15,000)</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Noise Level</div>
                            <div class="metric-value">65 dB</div>
                            <div class="metric-target">Target: <70 dB</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Vibration Level</div>
                            <div class="metric-value">2.5</div>
                            <div class="metric-target">mm/s (Target: <3.0)</div>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="designCapacityAchievement">Design Capacity Achievement (%)</label>
                            <input type="number" id="designCapacityAchievement" name="designCapacityAchievement" value="92" min="0" max="150">
                        </div>
                        <div class="form-group">
                            <label for="efficiencyAchievement">Efficiency Achievement (%)</label>
                            <input type="number" id="efficiencyAchievement" name="efficiencyAchievement" value="88" min="0" max="120">
                        </div>
                        <div class="form-group">
                            <label for="energyConsumption">Energy Consumption (kWh)</label>
                            <input type="number" id="energyConsumption" name="energyConsumption" value="4250" min="0">
                        </div>
                        <div class="form-group">
                            <label for="waterConsumption">Water Consumption (Liters)</label>
                            <input type="number" id="waterConsumption" name="waterConsumption" value="12500" min="0">
                        </div>
                        <div class="form-group">
                            <label for="noiseLevel">Noise Level (dB)</label>
                            <input type="number" id="noiseLevel" name="noiseLevel" value="65" min="0" max="120">
                        </div>
                        <div class="form-group">
                            <label for="vibrationLevel">Vibration Level (mm/s)</label>
                            <input type="number" id="vibrationLevel" name="vibrationLevel" value="2.5" min="0" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Issue Resolution -->
            <div class="form-section">
                <h2>Issue Resolution</h2>
                <div class="issue-tracker">
                    <h3>Testing Issues Summary</h3>
                    <div class="issue-summary">
                        <div class="issue-stat">
                            <div class="issue-stat-value">12</div>
                            <div class="issue-stat-label">Total Issues</div>
                        </div>
                        <div class="issue-stat">
                            <div class="issue-stat-value" style="color: #ef4444;">3</div>
                            <div class="issue-stat-label">Critical</div>
                        </div>
                        <div class="issue-stat">
                            <div class="issue-stat-value">8</div>
                            <div class="issue-stat-label">Resolved</div>
                        </div>
                        <div class="issue-stat">
                            <div class="issue-stat-value">4</div>
                            <div class="issue-stat-label">Pending</div>
                        </div>
                        <div class="issue-stat">
                            <div class="issue-stat-value">2.5</div>
                            <div class="issue-stat-label">Avg Days</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="testingIssuesIdentified">Testing Issues Identified</label>
                            <input type="number" id="testingIssuesIdentified" name="testingIssuesIdentified" value="12" min="0">
                        </div>
                        <div class="form-group">
                            <label for="criticalIssues">Critical Issues Count</label>
                            <input type="number" id="criticalIssues" name="criticalIssues" value="3" min="0">
                        </div>
                        <div class="form-group">
                            <label for="issuesResolved">Issues Resolved</label>
                            <input type="number" id="issuesResolved" name="issuesResolved" value="8" min="0">
                        </div>
                        <div class="form-group">
                            <label for="pendingIssues">Pending Issues</label>
                            <input type="number" id="pendingIssues" name="pendingIssues" value="4" readonly>
                        </div>
                        <div class="form-group">
                            <label for="issueResolutionTime">Average Issue Resolution Time (Days)</label>
                            <input type="number" id="issueResolutionTime" name="issueResolutionTime" value="2.5" readonly>
                        </div>
                        <div class="form-group">
                            <label for="retestingRequired">Retesting Required</label>
                            <select id="retestingRequired" name="retestingRequired">
                                <option value="">Select Option</option>
                                <option value="No Retesting">No Retesting</option>
                                <option value="Partial Retesting" selected>Partial Retesting</option>
                                <option value="Complete Retesting">Complete Retesting</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation & Certification -->
            <div class="form-section">
                <h2>Documentation & Certification</h2>
                <div class="documentation-checklist">
                    <h3>Required Documentation</h3>
                    <div class="doc-grid">
                        <div class="doc-item">
                            <input type="checkbox" id="operatingManuals" name="operatingManuals" checked>
                            <label for="operatingManuals">Operating Manuals Complete</label>
                        </div>
                        <div class="doc-item">
                            <input type="checkbox" id="maintenanceManuals" name="maintenanceManuals" checked>
                            <label for="maintenanceManuals">Maintenance Manuals Complete</label>
                        </div>
                        <div class="doc-item">
                            <input type="checkbox" id="testCertificates" name="testCertificates" checked>
                            <label for="testCertificates">Test Certificates Received</label>
                        </div>
                        <div class="doc-item">
                            <input type="checkbox" id="warrantyDocuments" name="warrantyDocuments">
                            <label for="warrantyDocuments">Warranty Documents Complete</label>
                        </div>
                        <div class="doc-item">
                            <input type="checkbox" id="asBuiltDrawings" name="asBuiltDrawings">
                            <label for="asBuiltDrawings">As-Built Drawings Complete</label>
                        </div>
                        <div class="doc-item">
                            <input type="checkbox" id="commissioningCertificate" name="commissioningCertificate">
                            <label for="commissioningCertificate">Commissioning Certificate Issued</label>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="operatingManualsStatus">Operating Manuals Status <span class="required">*</span></label>
                            <select id="operatingManualsStatus" name="operatingManualsStatus" required>
                                <option value="Complete" selected>Complete</option>
                                <option value="Incomplete">Incomplete</option>
                                <option value="Under Review">Under Review</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maintenanceManualsStatus">Maintenance Manuals Status <span class="required">*</span></label>
                            <select id="maintenanceManualsStatus" name="maintenanceManualsStatus" required>
                                <option value="Complete" selected>Complete</option>
                                <option value="Incomplete">Incomplete</option>
                                <option value="Under Review">Under Review</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="testCertificatesStatus">Test Certificates Status <span class="required">*</span></label>
                            <select id="testCertificatesStatus" name="testCertificatesStatus" required>
                                <option value="All Received" selected>All Received</option>
                                <option value="Partial">Partial</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="warrantyDocumentsStatus">Warranty Documents Status <span class="required">*</span></label>
                            <select id="warrantyDocumentsStatus" name="warrantyDocumentsStatus" required>
                                <option value="Complete">Complete</option>
                                <option value="Incomplete" selected>Incomplete</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="asBuiltDrawingsStatus">As-Built Drawings Status <span class="required">*</span></label>
                            <select id="asBuiltDrawingsStatus" name="asBuiltDrawingsStatus" required>
                                <option value="Complete">Complete</option>
                                <option value="Incomplete" selected>Incomplete</option>
                                <option value="Under Review">Under Review</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="commissioningCertificateStatus">Commissioning Certificate Status</label>
                            <select id="commissioningCertificateStatus" name="commissioningCertificateStatus">
                                <option value="">Select Status</option>
                                <option value="Issued">Issued</option>
                                <option value="Conditional">Conditional</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Pending" selected>Pending</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Training & Handover -->
            <div class="form-section">
                <h2>Training & Handover</h2>
                <div class="training-section">
                    <h3>Training Progress</h3>
                    <div class="training-progress">
                        <div class="training-card">
                            <h4>Operator Training</h4>
                            <select id="operatorTraining" name="operatorTraining" required>
                                <option value="Completed">Completed</option>
                                <option value="In Progress" selected>In Progress</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="Not Started">Not Started</option>
                            </select>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%;"></div>
                            </div>
                            <p>Progress: 75% Complete</p>
                        </div>
                        
                        <div class="training-card">
                            <h4>Maintenance Training</h4>
                            <select id="maintenanceTraining" name="maintenanceTraining" required>
                                <option value="Completed">Completed</option>
                                <option value="In Progress" selected>In Progress</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="Not Started">Not Started</option>
                            </select>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%;"></div>
                            </div>
                            <p>Progress: 60% Complete</p>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="systemHandoverDate">System Handover Date</label>
                            <input type="date" id="systemHandoverDate" name="systemHandoverDate">
                        </div>
                        <div class="form-group">
                            <label for="handoverDocumentation">Handover Documentation Status</label>
                            <select id="handoverDocumentation" name="handoverDocumentation">
                                <option value="">Select Status</option>
                                <option value="Complete">Complete</option>
                                <option value="Incomplete" selected>Incomplete</option>
                                <option value="Under Preparation">Under Preparation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userAcceptance">User Acceptance Status</label>
                            <select id="userAcceptance" name="userAcceptance">
                                <option value="">Select Status</option>
                                <option value="Accepted">Accepted</option>
                                <option value="Conditional Acceptance">Conditional Acceptance</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Pending" selected>Pending</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Commissioning Approval -->
            <div class="form-section">
                <h2>Commissioning Approval</h2>
                <div class="commissioning-approval">
                    <div class="approval-header">
                        <h3>Commissioning Status</h3>
                        <span class="approval-status">Conditional Approval</span>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="commissioning_team_lead">Commissioning Team Lead <span class="required">*</span></label>
                            <input type="text" id="commissioning_team_lead" name="commissioning_team_lead" value="Er. K. Venkatesh, EE" required>
                        </div>
                        <div class="form-group">
                            <label for="external_commissioning_agency">External Commissioning Agency</label>
                            <input type="text" id="external_commissioning_agency" name="external_commissioning_agency" value="M/s Technical Testing Services Ltd">
                        </div>
                        <div class="form-group">
                            <label for="commissioning_report_status">Commissioning Report Status <span class="required">*</span></label>
                            <select id="commissioning_report_status" name="commissioning_report_status" required>
                                <option value="Draft">Draft</option>
                                <option value="Under Review" selected>Under Review</option>
                                <option value="Approved">Approved</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="commissioning_approval_date">Commissioning Approval Date</label>
                            <input type="date" id="commissioning_approval_date" name="commissioning_approval_date">
                        </div>
                        <div class="form-group">
                            <label for="commissioning_certificate_number">Commissioning Certificate Number</label>
                            <input type="text" id="commissioning_certificate_number" name="commissioning_certificate_number" placeholder="Certificate number">
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="conditional_approval_conditions">Conditional Approval Conditions</label>
                        <textarea id="conditional_approval_conditions" name="conditional_approval_conditions" rows="3" placeholder="Conditions attached to commissioning approval">1. Complete warranty documentation within 7 days
2. Resolve 2 critical performance parameters within 15 days
3. Complete remaining operator training modules
4. Submit final as-built drawings for approval</textarea>
                    </div>
                </div>
            </div>

            <!-- Final System Status -->
            <div class="form-section">
                <h2>Final System Status</h2>
                <div class="final-status-grid">
                    <div class="status-card">
                        <div class="status-icon" style="color: #f59e0b;">⚡</div>
                        <div class="status-title">Operational Status</div>
                        <select id="system_operational_status" name="system_operational_status" required>
                            <option value="Fully Operational">Fully Operational</option>
                            <option value="Partially Operational" selected>Partially Operational</option>
                            <option value="Not Operational">Not Operational</option>
                        </select>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-icon" style="color: #3b82f6;">⭐</div>
                        <div class="status-title">Performance Rating</div>
                        <select id="system_performance_rating" name="system_performance_rating" required>
                            <option value="Excellent">Excellent</option>
                            <option value="Good" selected>Good</option>
                            <option value="Satisfactory">Satisfactory</option>
                            <option value="Poor">Poor</option>
                        </select>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-icon" style="color: #059669;">🤝</div>
                        <div class="status-title">Handover Status</div>
                        <select id="handover_to_operations" name="handover_to_operations" required>
                            <option value="Completed">Completed</option>
                            <option value="Scheduled" selected>Scheduled</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid" style="margin-top: 20px;">
                    <div class="form-group">
                        <label for="commissioning_completion_date">Commissioning Completion Date</label>
                        <input type="date" id="commissioning_completion_date" name="commissioning_completion_date">
                    </div>
                    <div class="form-group">
                        <label for="next_maintenance_date">Next Maintenance Due Date</label>
                        <input type="date" id="next_maintenance_date" name="next_maintenance_date" value="2025-04-20" readonly>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn-secondary">Save as Draft</button>
                <button type="button" class="btn-secondary">Previous Stage</button>
                <button type="submit" class="btn-primary">Complete Testing & Commissioning</button>
            </div>
        </form>
    </div>

    <!-- Include feedback system -->
    <script src="shared/feedback-system.js"></script>
    <script>
        // Initialize feedback system
        document.addEventListener('DOMContentLoaded', function() {
            const feedbackSystem = new HMDAFeedbackSystem();
            
            // Update activity card status based on selection
            const activitySelects = document.querySelectorAll('.activity-card select');
            activitySelects.forEach(select => {
                select.addEventListener('change', function() {
                    const card = this.closest('.activity-card');
                    const statusSpan = card.querySelector('.activity-status');
                    const value = this.value;
                    
                    // Remove all classes
                    card.classList.remove('completed', 'in-progress', 'not-started');
                    statusSpan.classList.remove('status-completed', 'status-in-progress', 'status-not-started');
                    
                    // Add appropriate class
                    if (value === 'Completed' || value === 'Passed') {
                        card.classList.add('completed');
                        statusSpan.classList.add('status-completed');
                        statusSpan.textContent = value;
                    } else if (value === 'In Progress') {
                        card.classList.add('in-progress');
                        statusSpan.classList.add('status-in-progress');
                        statusSpan.textContent = 'In Progress';
                    } else if (value === 'Failed') {
                        card.classList.add('not-started');
                        statusSpan.classList.add('status-not-started');
                        statusSpan.textContent = 'Failed';
                    } else {
                        card.classList.add('not-started');
                        statusSpan.classList.add('status-not-started');
                        statusSpan.textContent = 'Not Started';
                    }
                });
            });
            
            // Update test item status based on selection
            const testSelects = document.querySelectorAll('.test-item select');
            testSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const item = this.closest('.test-item');
                    const value = this.value;
                    
                    // Remove all classes
                    item.classList.remove('passed', 'failed', 'in-progress');
                    
                    // Add appropriate class
                    if (value === 'Passed') {
                        item.classList.add('passed');
                    } else if (value === 'Failed') {
                        item.classList.add('failed');
                    } else if (value === 'In Progress') {
                        item.classList.add('in-progress');
                    }
                    
                    // Recalculate test statistics
                    calculateTestStats();
                });
            });
            
            // Calculate test statistics
            function calculateTestStats() {
                const allTests = document.querySelectorAll('.test-item select');
                let totalTests = 0;
                let passedTests = 0;
                
                allTests.forEach(select => {
                    if (select.value !== 'Not Applicable') {
                        totalTests++;
                        if (select.value === 'Passed') {
                            passedTests++;
                        }
                    }
                });
                
                document.getElementById('totalSystemsToTest').value = totalTests;
                document.getElementById('systemsTestPassed').value = passedTests;
                
                if (totalTests > 0) {
                    const passRate = (passedTests / totalTests * 100).toFixed(2);
                    document.getElementById('systemTestPassRate').value = passRate;
                }
            }
            
            // Calculate pending issues
            function calculatePendingIssues() {
                const total = parseInt(document.getElementById('testingIssuesIdentified').value) || 0;
                const resolved = parseInt(document.getElementById('issuesResolved').value) || 0;
                document.getElementById('pendingIssues').value = total - resolved;
            }
            
            document.getElementById('testingIssuesIdentified').addEventListener('input', calculatePendingIssues);
            document.getElementById('issuesResolved').addEventListener('input', calculatePendingIssues);
            
            // Update training progress bars
            const operatorTraining = document.getElementById('operatorTraining');
            const maintenanceTraining = document.getElementById('maintenanceTraining');
            
            operatorTraining.addEventListener('change', function() {
                const progressBar = this.parentElement.querySelector('.progress-fill');
                const progressText = this.parentElement.querySelector('p');
                
                if (this.value === 'Completed') {
                    progressBar.style.width = '100%';
                    progressText.textContent = 'Progress: 100% Complete';
                } else if (this.value === 'In Progress') {
                    progressBar.style.width = '75%';
                    progressText.textContent = 'Progress: 75% Complete';
                } else if (this.value === 'Scheduled') {
                    progressBar.style.width = '25%';
                    progressText.textContent = 'Progress: 25% Complete';
                } else {
                    progressBar.style.width = '0%';
                    progressText.textContent = 'Progress: 0% Complete';
                }
            });
            
            maintenanceTraining.addEventListener('change', function() {
                const progressBar = this.parentElement.querySelector('.progress-fill');
                const progressText = this.parentElement.querySelector('p');
                
                if (this.value === 'Completed') {
                    progressBar.style.width = '100%';
                    progressText.textContent = 'Progress: 100% Complete';
                } else if (this.value === 'In Progress') {
                    progressBar.style.width = '60%';
                    progressText.textContent = 'Progress: 60% Complete';
                } else if (this.value === 'Scheduled') {
                    progressBar.style.width = '20%';
                    progressText.textContent = 'Progress: 20% Complete';
                } else {
                    progressBar.style.width = '0%';
                    progressText.textContent = 'Progress: 0% Complete';
                }
            });
            
            // Update readiness indicators
            const testingReadiness = document.getElementById('testingReadiness');
            testingReadiness.addEventListener('change', function() {
                const readinessIndicator = document.querySelector('.readiness-indicators .readiness-item:last-child .readiness-icon');
                const readinessText = document.querySelector('.readiness-indicators .readiness-item:last-child strong');
                
                if (this.value === 'Ready for Testing') {
                    readinessIndicator.className = 'readiness-icon ready';
                    readinessIndicator.textContent = '✅';
                    readinessText.textContent = 'Ready for Testing';
                } else if (this.value === 'Partially Ready') {
                    readinessIndicator.className = 'readiness-icon partial';
                    readinessIndicator.textContent = '⚠️';
                    readinessText.textContent = 'Partially Ready';
                } else {
                    readinessIndicator.className = 'readiness-icon not-ready';
                    readinessIndicator.textContent = '❌';
                    readinessText.textContent = 'Not Ready';
                }
            });
            
            // Calculate next maintenance date
            const completionDate = document.getElementById('commissioning_completion_date');
            completionDate.addEventListener('change', function() {
                if (this.value) {
                    const date = new Date(this.value);
                    date.setMonth(date.getMonth() + 3); // 3 months after commissioning
                    document.getElementById('next_maintenance_date').value = date.toISOString().split('T')[0];
                }
            });
            
            // Form submission
            document.getElementById('stage7Form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Check pending issues
                const pendingIssues = parseInt(document.getElementById('pendingIssues').value) || 0;
                const criticalIssues = parseInt(document.getElementById('criticalIssues').value) || 0;
                
                if (criticalIssues > 0) {
                    if (!confirm(`There are ${criticalIssues} critical issues pending. Are you sure you want to proceed with commissioning?`)) {
                        return;
                    }
                }
                
                alert('Testing & Commissioning data updated successfully! System is ready for handover.');
            });
        });
    </script>
</body>
</html>