<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage 8: Project Closure & Handover - HMDA PES</title>
    <link rel="stylesheet" href="shared/styles.css">
    <link rel="stylesheet" href="shared/feedback-system.css">
    <style>
        .closure-overview {
            background: linear-gradient(135deg, #dcfce7 0%, #86efac 100%);
            border: 2px solid #059669;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .closure-overview h3 {
            color: #166534;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .closure-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #86efac;
            text-align: center;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin: 10px 0;
        }
        
        .summary-label {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .variance {
            font-size: 0.75rem;
            margin-top: 5px;
        }
        
        .variance.positive { color: #059669; }
        .variance.negative { color: #ef4444; }
        
        .certificates-section {
            background: #f0f9ff;
            border: 1px solid #0284c7;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .certificate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .certificate-card {
            background: white;
            border: 1px solid #e0f2fe;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }
        
        .certificate-card.issued {
            border-color: #059669;
            background: #f0fdf4;
        }
        
        .certificate-card.pending {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        
        .certificate-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-issued {
            background: #059669;
            color: white;
        }
        
        .status-pending {
            background: #f59e0b;
            color: white;
        }
        
        .bills-tracker {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .payment-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .payment-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fde68a;
            text-align: center;
        }
        
        .payment-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin: 5px 0;
        }
        
        .asset-handover {
            background: #ecfdf5;
            border: 1px solid #059669;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .handover-checklist {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .handover-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #86efac;
        }
        
        .handover-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .documentation-archive {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .archive-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .archive-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .archive-item.complete {
            border-color: #059669;
            background: #f0fdf4;
        }
        
        .archive-status-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-partial {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-pending {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .performance-analysis {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border: 1px solid #6366f1;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #a5b4fc;
            text-align: center;
        }
        
        .rating-display {
            font-size: 2rem;
            margin: 10px 0;
        }
        
        .lessons-learned {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .knowledge-section {
            margin-top: 20px;
        }
        
        .knowledge-item {
            background: white;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .knowledge-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .approval-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #059669;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .approval-badge {
            display: inline-block;
            padding: 10px 24px;
            border-radius: 24px;
            font-size: 18px;
            font-weight: 600;
            background: #059669;
            color: white;
        }
        
        .final-checklist {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }
        
        .checklist-section {
            background: white;
            border: 1px solid #86efac;
            border-radius: 8px;
            padding: 20px;
        }
        
        .checklist-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checklist-items {
            display: grid;
            gap: 10px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .pir-schedule {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .schedule-timeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .timeline-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fde68a;
            text-align: center;
        }
        
        .timeline-date {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .timeline-label {
            font-size: 0.875rem;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <div class="form-title">
                <h1>Stage 8: Project Closure & Handover</h1>
                <p>Complete project documentation, process final payments, and handover assets</p>
            </div>
            <div class="form-meta">
                <div class="meta-item">
                    <span class="meta-label">Project Code</span>
                    <span class="meta-value">HMDA/EE/2025/0001</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Stage</span>
                    <span class="meta-value">8 of 9</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Status</span>
                    <span class="meta-value status-active">In Progress</span>
                </div>
            </div>
        </div>

        <div class="progress-tracker">
            <div class="progress-step completed">1. Conceptualization</div>
            <div class="progress-step completed">2. DPR & Approvals</div>
            <div class="progress-step completed">3. Tendering</div>
            <div class="progress-step completed">4. Contract Award</div>
            <div class="progress-step completed">5. Execution</div>
            <div class="progress-step completed">6. Quality Control</div>
            <div class="progress-step completed">7. Testing</div>
            <div class="progress-step active">8. Closure</div>
            <div class="progress-step">9. DLP & O&M</div>
        </div>

        <form id="stage8Form" class="stage-form">
            <!-- Project Completion Overview -->
            <div class="form-section">
                <h2>Project Completion Overview</h2>
                <div class="closure-overview">
                    <h3>Project Closure Summary</h3>
                    <div class="closure-summary">
                        <div class="summary-card">
                            <div class="summary-label">Project Code</div>
                            <div class="summary-value">HMDA/EE/2025/0001</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Commissioning Status</div>
                            <div class="summary-value" style="color: #059669;">Successfully Commissioned</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Final Project Cost</div>
                            <div class="summary-value">₹154.25 Lakhs</div>
                            <div class="variance negative">+₹4.75 Lakhs (+3.17%)</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Actual Duration</div>
                            <div class="summary-value">19 Months</div>
                            <div class="variance negative">+1 Month (+5.6%)</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Schedule Variance</div>
                            <div class="summary-value">+30 Days</div>
                            <div class="variance negative">Delayed</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Cost Variance</div>
                            <div class="summary-value">₹4.75 Lakhs</div>
                            <div class="variance negative">Over Budget</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Completion Certificates - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Completion Certificates</h2>
                <div class="certificates-section">
                    <div class="certificate-grid">
                        <div class="certificate-card issued">
                            <span class="certificate-status status-issued">ISSUED</span>
                            <label for="projectCompletionCertificate">Project Completion Certificate <span class="required">*</span></label>
                            <select id="projectCompletionCertificate" name="projectCompletionCertificate" required>
                                <option value="Issued" selected>Issued</option>
                                <option value="Draft">Draft</option>
                                <option value="Under Review">Under Review</option>
                                <option value="Pending">Pending</option>
                            </select>
                            <div class="form-group" style="margin-top: 10px;">
                                <input type="text" id="completionCertificateNumber" name="completionCertificateNumber" 
                                       placeholder="Certificate Number" value="HMDA/CC/2025/0234">
                            </div>
                            <div class="form-group">
                                <input type="date" id="completionCertificateDate" name="completionCertificateDate" 
                                       value="2025-01-20">
                            </div>
                        </div>
                        
                        <div class="certificate-card issued">
                            <span class="certificate-status status-issued">ISSUED</span>
                            <label for="engineerInChargeCertificate">Engineer-in-Charge Certificate <span class="required">*</span></label>
                            <select id="engineerInChargeCertificate" name="engineerInChargeCertificate" required>
                                <option value="Issued" selected>Issued</option>
                                <option value="Pending">Pending</option>
                                <option value="Conditional">Conditional</option>
                            </select>
                        </div>
                        
                        <div class="certificate-card pending">
                            <span class="certificate-status status-pending">PENDING</span>
                            <label for="architectCertificate">Architect Certificate</label>
                            <select id="architectCertificate" name="architectCertificate">
                                <option value="">Select Status</option>
                                <option value="Issued">Issued</option>
                                <option value="Pending" selected>Pending</option>
                                <option value="Conditional">Conditional</option>
                                <option value="Not Required">Not Required</option>
                            </select>
                        </div>
                        
                        <div class="certificate-card issued">
                            <span class="certificate-status status-issued">ISSUED</span>
                            <label for="consultantCertificate">Consultant Certificate</label>
                            <select id="consultantCertificate" name="consultantCertificate">
                                <option value="">Select Status</option>
                                <option value="Issued" selected>Issued</option>
                                <option value="Pending">Pending</option>
                                <option value="Conditional">Conditional</option>
                                <option value="Not Required">Not Required</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Bills & Payments -->
            <div class="form-section">
                <h2>Final Bills & Payments</h2>
                <div class="bills-tracker">
                    <h3>Payment Summary</h3>
                    <div class="payment-summary">
                        <div class="payment-item">
                            <div class="summary-label">Contract Value</div>
                            <div class="payment-value">₹149.50 Lakhs</div>
                        </div>
                        <div class="payment-item">
                            <div class="summary-label">Total Paid Till Date</div>
                            <div class="payment-value" style="color: #059669;">₹142.03 Lakhs</div>
                        </div>
                        <div class="payment-item">
                            <div class="summary-label">Final Bill Amount</div>
                            <div class="payment-value">₹12.22 Lakhs</div>
                        </div>
                        <div class="payment-item">
                            <div class="summary-label">Retention Held</div>
                            <div class="payment-value" style="color: #f59e0b;">₹14.95 Lakhs</div>
                        </div>
                        <div class="payment-item">
                            <div class="summary-label">Outstanding Due</div>
                            <div class="payment-value" style="color: #ef4444;">₹7.47 Lakhs</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="finalBillSubmitted">Final Bill Submitted <span class="required">*</span></label>
                            <select id="finalBillSubmitted" name="finalBillSubmitted" required>
                                <option value="Yes" selected>Yes</option>
                                <option value="No">No</option>
                                <option value="Under Preparation">Under Preparation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="finalBillAmount">Final Bill Amount (₹ Lakhs)</label>
                            <input type="number" id="finalBillAmount" name="finalBillAmount" value="12.22" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="finalBillApprovalStatus">Final Bill Approval Status</label>
                            <select id="finalBillApprovalStatus" name="finalBillApprovalStatus">
                                <option value="">Select Status</option>
                                <option value="Approved">Approved</option>
                                <option value="Under Review" selected>Under Review</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="totalAmountPaidFinal">Total Amount Paid (₹ Lakhs)</label>
                            <input type="number" id="totalAmountPaidFinal" name="totalAmountPaidFinal" value="142.03" readonly>
                        </div>
                        <div class="form-group">
                            <label for="retentionAmountHeld">Retention Amount Held (₹ Lakhs)</label>
                            <input type="number" id="retentionAmountHeld" name="retentionAmountHeld" value="14.95" readonly>
                        </div>
                        <div class="form-group">
                            <label for="retentionReleaseStatus">Retention Release Status</label>
                            <select id="retentionReleaseStatus" name="retentionReleaseStatus">
                                <option value="">Select Status</option>
                                <option value="Not Due" selected>Not Due</option>
                                <option value="Eligible for Release">Eligible for Release</option>
                                <option value="Released">Released</option>
                                <option value="Partial Release">Partial Release</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="outstandingAmountDue">Outstanding Amount Due (₹ Lakhs)</label>
                            <input type="number" id="outstandingAmountDue" name="outstandingAmountDue" value="7.47" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Asset Handover - REMOVED per HMDA feedback (includes Documents Handover) -->
            <div class="form-section" style="display:none;">
                <h2>Asset Handover</h2>
                <div class="asset-handover">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="assetHandoverStatus">Asset Handover Status <span class="required">*</span></label>
                            <select id="assetHandoverStatus" name="assetHandoverStatus" required>
                                <option value="Completed">Completed</option>
                                <option value="In Progress" selected>In Progress</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="handoverDate">Asset Handover Date</label>
                            <input type="date" id="handoverDate" name="handoverDate">
                        </div>
                        <div class="form-group">
                            <label for="handoverRecipient">Handover Recipient <span class="required">*</span></label>
                            <input type="text" id="handoverRecipient" name="handoverRecipient" 
                                   value="HMDA Maintenance Division - Er. P. Suresh, AE" required>
                        </div>
                        <div class="form-group">
                            <label for="assetInventoryStatus">Asset Inventory Status <span class="required">*</span></label>
                            <select id="assetInventoryStatus" name="assetInventoryStatus" required>
                                <option value="Complete" selected>Complete</option>
                                <option value="Under Preparation">Under Preparation</option>
                                <option value="Verified">Verified</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px;">Documentation Handover Checklist</h4>
                    <div class="handover-checklist">
                        <div class="handover-item">
                            <input type="checkbox" id="operatingManualsHandover" name="operatingManualsHandover" checked>
                            <label for="operatingManualsHandover">Operating Manuals</label>
                        </div>
                        <div class="handover-item">
                            <input type="checkbox" id="maintenanceManualsHandover" name="maintenanceManualsHandover" checked>
                            <label for="maintenanceManualsHandover">Maintenance Manuals</label>
                        </div>
                        <div class="handover-item">
                            <input type="checkbox" id="warrantyDocumentsHandover" name="warrantyDocumentsHandover">
                            <label for="warrantyDocumentsHandover">Warranty Documents</label>
                        </div>
                        <div class="handover-item">
                            <input type="checkbox" id="asBuiltDrawings" name="asBuiltDrawings">
                            <label for="asBuiltDrawings">As-Built Drawings</label>
                        </div>
                        <div class="handover-item">
                            <input type="checkbox" id="testCertificates" name="testCertificates" checked>
                            <label for="testCertificates">Test Certificates</label>
                        </div>
                        <div class="handover-item">
                            <input type="checkbox" id="sparePartsList" name="sparePartsList" checked>
                            <label for="sparePartsList">Spare Parts List</label>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="operatingManualsHandoverStatus">Operating Manuals Handover <span class="required">*</span></label>
                            <select id="operatingManualsHandoverStatus" name="operatingManualsHandoverStatus" required>
                                <option value="Completed" selected>Completed</option>
                                <option value="Partial">Partial</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maintenanceManualsHandoverStatus">Maintenance Manuals Handover <span class="required">*</span></label>
                            <select id="maintenanceManualsHandoverStatus" name="maintenanceManualsHandoverStatus" required>
                                <option value="Completed" selected>Completed</option>
                                <option value="Partial">Partial</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="warrantyDocumentsHandoverStatus">Warranty Documents Handover <span class="required">*</span></label>
                            <select id="warrantyDocumentsHandoverStatus" name="warrantyDocumentsHandoverStatus" required>
                                <option value="Completed">Completed</option>
                                <option value="Partial" selected>Partial</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- As-Built Documentation - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>As-Built Documentation</h2>
                <div class="documentation-archive">
                    <div class="archive-status">
                        <div class="archive-item complete">
                            <span>As-Built Drawings Status</span>
                            <span class="archive-status-badge status-complete">Complete</span>
                        </div>
                        <div class="archive-item complete">
                            <span>Survey Records Status</span>
                            <span class="archive-status-badge status-complete">Complete</span>
                        </div>
                        <div class="archive-item">
                            <span>GIS Data Updation</span>
                            <span class="archive-status-badge status-partial">In Progress</span>
                        </div>
                        <div class="archive-item">
                            <span>Record Drawings Archival</span>
                            <span class="archive-status-badge status-partial">Partial</span>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="asBuiltDrawingsStatus">As-Built Drawings Status <span class="required">*</span></label>
                            <select id="asBuiltDrawingsStatus" name="asBuiltDrawingsStatus" required>
                                <option value="Complete" selected>Complete</option>
                                <option value="Under Review">Under Review</option>
                                <option value="Incomplete">Incomplete</option>
                                <option value="Approved">Approved</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="asBuiltDrawingsSubmissionDate">As-Built Submission Date</label>
                            <input type="date" id="asBuiltDrawingsSubmissionDate" name="asBuiltDrawingsSubmissionDate" value="2025-01-15">
                        </div>
                        <div class="form-group">
                            <label for="asBuiltDrawingsApprovalDate">As-Built Approval Date</label>
                            <input type="date" id="asBuiltDrawingsApprovalDate" name="asBuiltDrawingsApprovalDate" value="2025-01-18">
                        </div>
                        <div class="form-group">
                            <label for="recordDrawingsArchival">Record Drawings Archival</label>
                            <select id="recordDrawingsArchival" name="recordDrawingsArchival">
                                <option value="">Select Status</option>
                                <option value="Digital Archive Complete">Digital Archive Complete</option>
                                <option value="Physical Archive Complete">Physical Archive Complete</option>
                                <option value="Partial" selected>Partial</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="surveyRecordsStatus">Survey Records Status <span class="required">*</span></label>
                            <select id="surveyRecordsStatus" name="surveyRecordsStatus" required>
                                <option value="Complete" selected>Complete</option>
                                <option value="Under Review">Under Review</option>
                                <option value="Incomplete">Incomplete</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gisDataUpdation">GIS Data Updation Status</label>
                            <select id="gisDataUpdation" name="gisDataUpdation">
                                <option value="">Select Status</option>
                                <option value="Updated">Updated</option>
                                <option value="Under Review" selected>Under Review</option>
                                <option value="Pending">Pending</option>
                                <option value="Not Required">Not Required</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Closure - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Financial Closure</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="finalAccountsStatus">Final Accounts Status <span class="required">*</span></label>
                        <select id="finalAccountsStatus" name="finalAccountsStatus" required>
                            <option value="Closed">Closed</option>
                            <option value="Under Preparation" selected>Under Preparation</option>
                            <option value="Pending Approval">Pending Approval</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="finalAuditStatus">Final Audit Status</label>
                        <select id="finalAuditStatus" name="finalAuditStatus">
                            <option value="">Select Status</option>
                            <option value="Completed">Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Scheduled" selected>Scheduled</option>
                            <option value="Not Required">Not Required</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="utilizationCertificate">Utilization Certificate Status <span class="required">*</span></label>
                        <select id="utilizationCertificate" name="utilizationCertificate" required>
                            <option value="Issued">Issued</option>
                            <option value="Under Preparation" selected>Under Preparation</option>
                            <option value="Pending Approval">Pending Approval</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="closureAuditReport">Closure Audit Report</label>
                        <select id="closureAuditReport" name="closureAuditReport">
                            <option value="">Select Status</option>
                            <option value="Submitted">Submitted</option>
                            <option value="Under Review">Under Review</option>
                            <option value="Approved">Approved</option>
                            <option value="Pending" selected>Pending</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="financialRecordsArchival">Financial Records Archival <span class="required">*</span></label>
                        <select id="financialRecordsArchival" name="financialRecordsArchival" required>
                            <option value="Complete">Complete</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Project Performance Analysis - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Project Performance Analysis</h2>
                <div class="performance-analysis">
                    <h3>Performance Ratings</h3>
                    <div class="performance-metrics">
                        <div class="metric-card">
                            <div class="summary-label">Project Success Rating</div>
                            <div class="rating-display">⭐⭐⭐⭐</div>
                            <select id="projectSuccessRating" name="projectSuccessRating" required>
                                <option value="Highly Successful">Highly Successful</option>
                                <option value="Successful" selected>Successful</option>
                                <option value="Moderately Successful">Moderately Successful</option>
                                <option value="Partially Successful">Partially Successful</option>
                                <option value="Unsuccessful">Unsuccessful</option>
                            </select>
                        </div>
                        
                        <div class="metric-card">
                            <div class="summary-label">Stakeholder Satisfaction</div>
                            <div class="rating-display">⭐⭐⭐⭐</div>
                            <select id="stakeholderSatisfactionRating" name="stakeholderSatisfactionRating" required>
                                <option value="Very Satisfied">Very Satisfied</option>
                                <option value="Satisfied" selected>Satisfied</option>
                                <option value="Neutral">Neutral</option>
                                <option value="Dissatisfied">Dissatisfied</option>
                                <option value="Very Dissatisfied">Very Dissatisfied</option>
                            </select>
                        </div>
                        
                        <div class="metric-card">
                            <div class="summary-label">Quality of Deliverables</div>
                            <div class="rating-display">⭐⭐⭐⭐⭐</div>
                            <select id="qualityDeliverableRating" name="qualityDeliverableRating" required>
                                <option value="Excellent" selected>Excellent</option>
                                <option value="Good">Good</option>
                                <option value="Satisfactory">Satisfactory</option>
                                <option value="Poor">Poor</option>
                                <option value="Unacceptable">Unacceptable</option>
                            </select>
                        </div>
                        
                        <div class="metric-card">
                            <div class="summary-label">Schedule Performance</div>
                            <div class="summary-value">0.95</div>
                            <input type="number" id="schedulePerformanceIndex" name="schedulePerformanceIndex" 
                                   value="0.95" readonly step="0.01">
                        </div>
                        
                        <div class="metric-card">
                            <div class="summary-label">Cost Performance</div>
                            <div class="summary-value">0.97</div>
                            <input type="number" id="costPerformanceIndex" name="costPerformanceIndex" 
                                   value="0.97" readonly step="0.01">
                        </div>
                        
                        <div class="metric-card">
                            <div class="summary-label">Benefit Realization</div>
                            <select id="benefitRealizationStatus" name="benefitRealizationStatus">
                                <option value="">Select Status</option>
                                <option value="Benefits Realized" selected>Benefits Realized</option>
                                <option value="Partial Realization">Partial Realization</option>
                                <option value="Benefits Pending">Benefits Pending</option>
                                <option value="Under Assessment">Under Assessment</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lessons Learned - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Lessons Learned</h2>
                <div class="lessons-learned">
                    <div class="knowledge-section">
                        <div class="knowledge-item">
                            <div class="knowledge-title">Key Success Factors</div>
                            <textarea id="keySuccessFactors" name="keySuccessFactors" rows="3" 
                                      placeholder="Key factors that contributed to project success">1. Strong stakeholder engagement throughout the project
2. Effective three-tier quality control system implementation
3. Proactive risk management and mitigation strategies
4. Regular progress monitoring and corrective actions
5. Experienced project team and contractor selection</textarea>
                        </div>
                        
                        <div class="knowledge-item">
                            <div class="knowledge-title">Major Challenges Faced</div>
                            <textarea id="challengesFaced" name="challengesFaced" rows="3" 
                                      placeholder="Major challenges encountered during project">1. Material price escalation during execution phase
2. Monsoon delays affecting construction schedule
3. Utility relocation coordination issues
4. Change in specifications for pavement materials
5. COVID-19 impact on labor availability</textarea>
                        </div>
                        
                        <div class="knowledge-item">
                            <div class="knowledge-title">Lessons Learned</div>
                            <textarea id="lessonsLearned" name="lessonsLearned" rows="3" 
                                      placeholder="Key lessons learned for future projects">1. Include comprehensive price escalation clauses in contracts
2. Build additional buffer for monsoon season in schedule
3. Early engagement with utility agencies is critical
4. Material specifications should be frozen before tendering
5. Maintain contingency plans for labor shortages</textarea>
                        </div>
                        
                        <div class="knowledge-item">
                            <div class="knowledge-title">Best Practices Identified</div>
                            <textarea id="bestPracticesIdentified" name="bestPracticesIdentified" rows="3" 
                                      placeholder="Best practices identified during project execution">1. Weekly progress review meetings with all stakeholders
2. Digital documentation and real-time reporting systems
3. Contractor performance rating system implementation
4. Quality control checklists at each construction stage
5. Safety training programs for all site personnel</textarea>
                        </div>
                        
                        <div class="knowledge-item">
                            <div class="knowledge-title">Improvement Recommendations</div>
                            <textarea id="improvementRecommendations" name="improvementRecommendations" rows="3" 
                                      placeholder="Recommendations for future project improvements">1. Implement integrated project management software
2. Establish dedicated utility coordination cell
3. Enhance pre-qualification criteria for contractors
4. Develop standard operating procedures for each stage
5. Create knowledge repository for future reference</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Knowledge Transfer - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Knowledge Transfer</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="projectDocumentationStatus">Project Documentation Status <span class="required">*</span></label>
                        <select id="projectDocumentationStatus" name="projectDocumentationStatus" required>
                            <option value="Complete">Complete</option>
                            <option value="Comprehensive" selected>Comprehensive</option>
                            <option value="Adequate">Adequate</option>
                            <option value="Incomplete">Incomplete</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="knowledgeTransferSessions">Knowledge Transfer Sessions</label>
                        <input type="number" id="knowledgeTransferSessions" name="knowledgeTransferSessions" value="3" min="0">
                    </div>
                    <div class="form-group">
                        <label for="trainingMaterialsStatus">Training Materials Status</label>
                        <select id="trainingMaterialsStatus" name="trainingMaterialsStatus">
                            <option value="">Select Status</option>
                            <option value="Complete" selected>Complete</option>
                            <option value="Under Development">Under Development</option>
                            <option value="Partial">Partial</option>
                            <option value="Not Required">Not Required</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="operationalHandoverTraining">Operational Handover Training <span class="required">*</span></label>
                        <select id="operationalHandoverTraining" name="operationalHandoverTraining" required>
                            <option value="Completed" selected>Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="technicalDocumentationArchival">Technical Documentation Archival <span class="required">*</span></label>
                        <select id="technicalDocumentationArchival" name="technicalDocumentationArchival" required>
                            <option value="Complete">Complete</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Warranty & Defect Liability - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Warranty & Defect Liability</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="defectLiabilityPeriod">Defect Liability Period (Months)</label>
                        <input type="number" id="defectLiabilityPeriod" name="defectLiabilityPeriod" value="12" readonly>
                    </div>
                    <div class="form-group">
                        <label for="dlpStartDate">DLP Start Date</label>
                        <input type="date" id="dlpStartDate" name="dlpStartDate" value="2025-01-20" readonly>
                    </div>
                    <div class="form-group">
                        <label for="dlpEndDate">DLP End Date</label>
                        <input type="date" id="dlpEndDate" name="dlpEndDate" value="2026-01-20" readonly>
                    </div>
                    <div class="form-group">
                        <label for="warrantyPeriod">Warranty Period (Months)</label>
                        <input type="number" id="warrantyPeriod" name="warrantyPeriod" value="24" readonly>
                    </div>
                    <div class="form-group">
                        <label for="performanceSecurityRetained">Performance Security Retained (₹ Lakhs)</label>
                        <input type="number" id="performanceSecurityRetained" name="performanceSecurityRetained" value="14.95" readonly>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceResponsibility">Maintenance Responsibility During DLP <span class="required">*</span></label>
                        <select id="maintenanceResponsibility" name="maintenanceResponsibility" required>
                            <option value="Contractor" selected>Contractor</option>
                            <option value="HMDA">HMDA</option>
                            <option value="Shared">Shared</option>
                            <option value="Third Party">Third Party</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Stakeholder Communication - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Stakeholder Communication</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="closureCommunication">Project Closure Communication <span class="required">*</span></label>
                        <select id="closureCommunication" name="closureCommunication" required>
                            <option value="Completed" selected>Completed</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="beneficiaryCommunication">Beneficiary Communication <span class="required">*</span></label>
                        <select id="beneficiaryCommunication" name="beneficiaryCommunication" required>
                            <option value="Completed">Completed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mediaAnnouncement">Media Announcement</label>
                        <select id="mediaAnnouncement" name="mediaAnnouncement">
                            <option value="">Select Status</option>
                            <option value="Released">Released</option>
                            <option value="Scheduled" selected>Scheduled</option>
                            <option value="Under Preparation">Under Preparation</option>
                            <option value="Not Required">Not Required</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inauguralEventStatus">Inaugural Event Status</label>
                        <select id="inauguralEventStatus" name="inauguralEventStatus">
                            <option value="">Select Status</option>
                            <option value="Completed">Completed</option>
                            <option value="Scheduled" selected>Scheduled</option>
                            <option value="Under Planning">Under Planning</option>
                            <option value="Not Required">Not Required</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackCollectionStatus">Stakeholder Feedback Collection</label>
                        <select id="feedbackCollectionStatus" name="feedbackCollectionStatus">
                            <option value="">Select Status</option>
                            <option value="Completed">Completed</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Project Closure Approval - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Project Closure Approval</h2>
                <div class="approval-section">
                    <div class="approval-header">
                        <h3>Closure Approval Status</h3>
                        <span class="approval-badge">Under Review</span>
                    </div>
                    
                    <div class="final-checklist">
                        <div class="checklist-section">
                            <div class="checklist-title">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                                </svg>
                                Technical Completion
                            </div>
                            <div class="checklist-items">
                                <div class="checklist-item">
                                    <input type="checkbox" id="techCompletion1" checked>
                                    <label for="techCompletion1">All construction work completed</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="techCompletion2" checked>
                                    <label for="techCompletion2">Quality control requirements met</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="techCompletion3" checked>
                                    <label for="techCompletion3">Testing & commissioning successful</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-section">
                            <div class="checklist-title">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"/>
                                </svg>
                                Financial Completion
                            </div>
                            <div class="checklist-items">
                                <div class="checklist-item">
                                    <input type="checkbox" id="finCompletion1" checked>
                                    <label for="finCompletion1">Final bills processed</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="finCompletion2">
                                    <label for="finCompletion2">Accounts reconciled</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="finCompletion3">
                                    <label for="finCompletion3">Audit completed</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checklist-section">
                            <div class="checklist-title">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm3 5a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm0 3a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z"/>
                                </svg>
                                Documentation Completion
                            </div>
                            <div class="checklist-items">
                                <div class="checklist-item">
                                    <input type="checkbox" id="docCompletion1" checked>
                                    <label for="docCompletion1">As-built drawings submitted</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="docCompletion2" checked>
                                    <label for="docCompletion2">All manuals handed over</label>
                                </div>
                                <div class="checklist-item">
                                    <input type="checkbox" id="docCompletion3">
                                    <label for="docCompletion3">Project records archived</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="closureApprovalStatus">Project Closure Approval Status <span class="required">*</span></label>
                            <select id="closureApprovalStatus" name="closureApprovalStatus" required>
                                <option value="Approved">Approved</option>
                                <option value="Under Review" selected>Under Review</option>
                                <option value="Conditional Approval">Conditional Approval</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="closureApprovalDate">Closure Approval Date</label>
                            <input type="date" id="closureApprovalDate" name="closureApprovalDate">
                        </div>
                        <div class="form-group">
                            <label for="closureApprovalAuthority">Closure Approval Authority</label>
                            <input type="text" id="closureApprovalAuthority" name="closureApprovalAuthority" 
                                   value="Executive Engineer" readonly>
                        </div>
                        <div class="form-group">
                            <label for="finalClosureDate">Final Project Closure Date</label>
                            <input type="date" id="finalClosureDate" name="finalClosureDate">
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="conditionalClosureConditions">Conditional Closure Conditions</label>
                        <textarea id="conditionalClosureConditions" name="conditionalClosureConditions" rows="3" 
                                  placeholder="Conditions attached to conditional closure approval">1. Complete warranty documentation within 7 days
2. Submit final audit report within 15 days
3. Archive all project records digitally
4. Complete GIS data updation</textarea>
                    </div>
                </div>
            </div>

            <!-- Post-Implementation Review - REMOVED per HMDA feedback -->
            <div class="form-section" style="display:none;">
                <h2>Post-Implementation Review</h2>
                <div class="pir-schedule">
                    <h3>Review Schedule</h3>
                    <div class="schedule-timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">15-Apr-2025</div>
                            <div class="timeline-label">3-Month Review</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">15-Jul-2025</div>
                            <div class="timeline-label">6-Month Review</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">15-Jan-2026</div>
                            <div class="timeline-label">12-Month Review</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">15-Jan-2027</div>
                            <div class="timeline-label">24-Month Review</div>
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="postImplementationReviewScheduled">Post-Implementation Review Scheduled</label>
                            <select id="postImplementationReviewScheduled" name="postImplementationReviewScheduled">
                                <option value="">Select Status</option>
                                <option value="Scheduled" selected>Scheduled</option>
                                <option value="Under Planning">Under Planning</option>
                                <option value="Not Required">Not Required</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="benefitRealizationReviewDate">Benefit Realization Review Date</label>
                            <input type="date" id="benefitRealizationReviewDate" name="benefitRealizationReviewDate" 
                                   value="2025-04-15">
                        </div>
                        <div class="form-group">
                            <label for="performanceMonitoringPlan">Performance Monitoring Plan</label>
                            <select id="performanceMonitoringPlan" name="performanceMonitoringPlan">
                                <option value="">Select Status</option>
                                <option value="Developed" selected>Developed</option>
                                <option value="Under Development">Under Development</option>
                                <option value="Not Required">Not Required</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="longTermSuccessMetrics">Long-term Success Metrics</label>
                        <textarea id="longTermSuccessMetrics" name="longTermSuccessMetrics" rows="3" 
                                  placeholder="Defined metrics for long-term project success">1. Traffic flow improvement: >30% reduction in congestion
2. Accident reduction: >20% decrease in road accidents
3. Asset condition: Maintain >85% pavement quality index
4. User satisfaction: >80% positive feedback rating
5. Economic impact: >15% increase in local business activity</textarea>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn-secondary">Save as Draft</button>
                <button type="button" class="btn-secondary">Previous Stage</button>
                <button type="submit" class="btn-primary">Complete Project Closure</button>
            </div>
        </form>
    </div>

    <!-- Include feedback system -->
    <script src="shared/feedback-system.js"></script>
    <script>
        // Initialize feedback system
        document.addEventListener('DOMContentLoaded', function() {
            const feedbackSystem = new HMDAFeedbackSystem();
            
            // Update certificate card status
            const certificateSelects = document.querySelectorAll('.certificate-card select');
            certificateSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const card = this.closest('.certificate-card');
                    const statusSpan = card.querySelector('.certificate-status');
                    const value = this.value;
                    
                    // Remove all classes
                    card.classList.remove('issued', 'pending');
                    statusSpan.classList.remove('status-issued', 'status-pending');
                    
                    // Add appropriate class
                    if (value === 'Issued') {
                        card.classList.add('issued');
                        statusSpan.classList.add('status-issued');
                        statusSpan.textContent = 'ISSUED';
                    } else {
                        card.classList.add('pending');
                        statusSpan.classList.add('status-pending');
                        statusSpan.textContent = 'PENDING';
                    }
                });
            });
            
            // Update archive item status
            function updateArchiveStatus() {
                const archiveItems = document.querySelectorAll('.archive-item');
                const asBuiltStatus = document.getElementById('asBuiltDrawingsStatus').value;
                const surveyStatus = document.getElementById('surveyRecordsStatus').value;
                const gisStatus = document.getElementById('gisDataUpdation').value;
                const archivalStatus = document.getElementById('recordDrawingsArchival').value;
                
                // Update as-built status
                if (asBuiltStatus === 'Complete' || asBuiltStatus === 'Approved') {
                    archiveItems[0].classList.add('complete');
                    archiveItems[0].querySelector('.archive-status-badge').className = 'archive-status-badge status-complete';
                    archiveItems[0].querySelector('.archive-status-badge').textContent = 'Complete';
                }
                
                // Update survey status
                if (surveyStatus === 'Complete') {
                    archiveItems[1].classList.add('complete');
                    archiveItems[1].querySelector('.archive-status-badge').className = 'archive-status-badge status-complete';
                    archiveItems[1].querySelector('.archive-status-badge').textContent = 'Complete';
                }
            }
            
            document.getElementById('asBuiltDrawingsStatus').addEventListener('change', updateArchiveStatus);
            document.getElementById('surveyRecordsStatus').addEventListener('change', updateArchiveStatus);
            
            // Calculate outstanding amount
            function calculateOutstanding() {
                const finalBill = parseFloat(document.getElementById('finalBillAmount').value) || 0;
                const totalPaid = parseFloat(document.getElementById('totalAmountPaidFinal').value) || 0;
                const outstanding = finalBill - (totalPaid - 142.03); // Adjusting for already paid amount
                document.getElementById('outstandingAmountDue').value = outstanding.toFixed(2);
            }
            
            document.getElementById('finalBillAmount').addEventListener('input', calculateOutstanding);
            
            // Update rating displays
            const ratingSelects = document.querySelectorAll('.metric-card select');
            ratingSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const ratingDisplay = this.parentElement.querySelector('.rating-display');
                    if (ratingDisplay) {
                        let stars = '';
                        switch(this.value) {
                            case 'Highly Successful':
                            case 'Very Satisfied':
                            case 'Excellent':
                                stars = '⭐⭐⭐⭐⭐';
                                break;
                            case 'Successful':
                            case 'Satisfied':
                            case 'Good':
                                stars = '⭐⭐⭐⭐';
                                break;
                            case 'Moderately Successful':
                            case 'Neutral':
                            case 'Satisfactory':
                                stars = '⭐⭐⭐';
                                break;
                            case 'Partially Successful':
                            case 'Dissatisfied':
                            case 'Poor':
                                stars = '⭐⭐';
                                break;
                            default:
                                stars = '⭐';
                        }
                        ratingDisplay.textContent = stars;
                    }
                });
            });
            
            // Update approval badge
            const closureApprovalStatus = document.getElementById('closureApprovalStatus');
            closureApprovalStatus.addEventListener('change', function() {
                const badge = document.querySelector('.approval-badge');
                const value = this.value;
                
                badge.textContent = value;
                if (value === 'Approved') {
                    badge.style.background = '#059669';
                } else if (value === 'Under Review') {
                    badge.style.background = '#3b82f6';
                } else if (value === 'Conditional Approval') {
                    badge.style.background = '#f59e0b';
                } else {
                    badge.style.background = '#6b7280';
                }
            });
            
            // Calculate DLP dates
            const dlpStartDate = document.getElementById('dlpStartDate');
            const dlpEndDate = document.getElementById('dlpEndDate');
            const completionCertificateDate = document.getElementById('completionCertificateDate');
            
            completionCertificateDate.addEventListener('change', function() {
                if (this.value) {
                    const startDate = new Date(this.value);
                    dlpStartDate.value = startDate.toISOString().split('T')[0];
                    
                    const endDate = new Date(startDate);
                    endDate.setMonth(endDate.getMonth() + 12); // 12 month DLP
                    dlpEndDate.value = endDate.toISOString().split('T')[0];
                }
            });
            
            // Update handover checklist
            const handoverCheckboxes = document.querySelectorAll('.handover-item input[type="checkbox"]');
            handoverCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const correspondingSelect = document.getElementById(this.id + 'Status');
                    if (correspondingSelect) {
                        if (this.checked) {
                            correspondingSelect.value = 'Completed';
                        } else {
                            correspondingSelect.value = 'Pending';
                        }
                    }
                });
            });
            
            // Form submission
            document.getElementById('stage8Form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Check all checklists
                const techChecks = document.querySelectorAll('#techCompletion1, #techCompletion2, #techCompletion3');
                const finChecks = document.querySelectorAll('#finCompletion1, #finCompletion2, #finCompletion3');
                const docChecks = document.querySelectorAll('#docCompletion1, #docCompletion2, #docCompletion3');
                
                let allTechComplete = Array.from(techChecks).every(cb => cb.checked);
                let allFinComplete = Array.from(finChecks).every(cb => cb.checked);
                let allDocComplete = Array.from(docChecks).every(cb => cb.checked);
                
                if (!allTechComplete || !allFinComplete || !allDocComplete) {
                    if (!confirm('Some closure checklist items are incomplete. Do you want to proceed with conditional closure?')) {
                        return;
                    }
                }
                
                alert('Project Closure completed successfully! Project is ready for DLP & O&M phase.');
            });
        });
    </script>
</body>
</html>